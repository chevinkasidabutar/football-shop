<nav class="fixed w-full z-50 bg-white/80 backdrop-blur border-b border-purple-100 transition-colors">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">

      <!-- Branding -->
      <div id="brand-logo" class="flex-shrink-0 transition-all duration-500">
        <a href="{% url 'main:show_main' %}"
           class="text-2xl font-extrabold text-purple-600 drop-shadow-[0_6px_22px_rgba(168,85,247,0.35)]">
          BolaBale <span class="text-gray-900">Store</span>
        </a>
      </div>

      <!-- Desktop Nav -->
      <div class="hidden md:flex items-center gap-2">
        <a id="nav-home-link"
           href="{% if is_home %}#home{% else %}{% url 'main:show_main' %}{% endif %}"
           class="px-3.5 py-2 rounded-full font-medium
                  {% if is_home %} bg-purple-100 text-purple-700 shadow-sm
                  {% else %} bg-gray-100 text-gray-700 hover:bg-purple-50 {% endif %}">
          Home
        </a>

        <a id="nav-all-link"
           href="{% if is_home %}#all{% else %}?filter=all{% endif %}"
           class="px-3.5 py-2 rounded-full font-medium
                  {% if filter_type == 'all' and not selected_category and not query and not is_home %}
                    bg-purple-100 text-purple-700 shadow-sm
                  {% else %} bg-gray-100 text-gray-700 hover:bg-purple-50 {% endif %}">
          All Products
        </a>

        <a href="?filter=my"
           class="px-3.5 py-2 rounded-full font-medium
                  {% if filter_type == 'my' %}
                    bg-purple-100 text-purple-700 shadow-sm
                  {% else %}
                    bg-gray-100 text-gray-700 hover:bg-purple-50
                  {% endif %}">
          My Products
        </a>

        {% if user.is_authenticated %}
          <button id="btnOpenCreate"
             class="ml-1 px-3.5 py-2 rounded-full font-semibold bg-purple-500/90 text-white hover:bg-purple-600 shadow-sm">
            + Create Product
          </button>
        {% endif %}
      </div>

      <!-- User area -->
      <div class="hidden md:flex items-center gap-3">
        {% if user.is_authenticated %}
          <div class="text-right leading-tight">
            <p class="text-sm font-semibold text-gray-900">{{ user.username }}</p>
            <p class="text-xs text-gray-500">{{ npm }} - {{ kelas }}</p>
          </div>
          <a href="{% url 'main:logout_user' %}" id="btnLogout" class="text-rose-500 font-medium hover:underline">Logout</a>
        {% else %}
          <a href="{% url 'main:login_user' %}"
             class="px-3.5 py-2 rounded-full bg-purple-600 text-white font-semibold hover:bg-purple-700 shadow-sm">
            Login
          </a>
        {% endif %}
      </div>

      <!-- Hamburger -->
      <div class="md:hidden">
        <button id="mobile-menu-btn" class="p-2 rounded-md text-gray-700 hover:bg-gray-100">
          <span class="sr-only">Toggle menu</span>
          &#9776;
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-purple-100 bg-white">
    <div class="px-4 py-3 space-y-2">
      <a href="{% if is_home %}#home{% else %}{% url 'main:show_main' %}{% endif %}" class="block px-2 py-2 rounded-lg font-medium text-gray-700 hover:bg-purple-50">Home</a>
      <a href="{% if is_home %}#all{% else %}?filter=all{% endif %}"  class="block px-2 py-2 rounded-lg font-medium text-gray-700 hover:bg-purple-50">All Products</a>
      <a href="?filter=my" class="block px-2 py-2 rounded-lg font-medium text-gray-700 hover:bg-purple-50">My Products</a>
      {% if user.is_authenticated %}
        <button id="btnOpenCreate" class="block w-full text-left px-2 py-2 rounded-lg font-medium text-purple-600 hover:bg-purple-50">+ Create Product</button>
        <a href="{% url 'main:logout_user' %}" id="btnLogoutMobile" class="block px-2 py-2 rounded-lg font-medium text-rose-500 hover:bg-rose-50">Logout</a>
      {% else %}
        <a href="{% url 'main:login_user' %}" class="block px-2 py-2 rounded-lg font-medium text-purple-600 hover:bg-purple-50">Login</a>
      {% endif %}
    </div>
  </div>
</nav>

<script>
  // hamburger
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  btn?.addEventListener('click', () => menu?.classList.toggle('hidden'));

  // Logout AJAX
  function getCookie(name){const v=`; ${document.cookie}`.split(`; ${name}=`);if(v.length===2)return v.pop().split(';').shift();}
  const CSRF_TOKEN = getCookie('csrftoken');
  function hookLogout(id){
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener('click', async (e)=>{
      e.preventDefault();
      try{
        const res = await fetch("{% url 'main:logout_ajax' %}", { method:'POST', headers:{'X-CSRFToken': CSRF_TOKEN} });
        const data = await res.json();
        if(!res.ok || !data.success) throw new Error('Logout failed');
        showToast('Logged out', 'Sampai jumpa!', 'success', 1200);
        setTimeout(()=>{ window.location.href = data.redirect || "{% url 'main:login_user' %}"; }, 600);
      }catch(err){
        console.error(err);
        showToast('Gagal logout', '', 'error', 2000);
      }
    });
  }
  hookLogout('btnLogout');
  hookLogout('btnLogoutMobile');
</script>
